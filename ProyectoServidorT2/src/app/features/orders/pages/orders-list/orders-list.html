<div class="orders-container">
  <div class="orders-header">
    <h1>Mis Pedidos</h1>
  </div>

  <div class="filters-section">
    <div class="filter-group">
      <label>Estado</label>
      <select [(ngModel)]="filters.state" (ngModelChange)="applyFilters()">
        <option value="">Todos</option>
        <option *ngFor="let s of states" [value]="s">{{ s }}</option>
      </select>
    </div>
    <div class="filter-group">
      <label>Fecha Desde</label>
      <input type="date" [(ngModel)]="filters.dateFrom" (ngModelChange)="applyFilters()">
    </div>
    <div class="filter-group">
      <label>Fecha Hasta</label>
      <input type="date" [(ngModel)]="filters.dateTo" (ngModelChange)="applyFilters()">
    </div>
    <div class="filter-group">
        <label>Precio Mín</label>
        <input type="number" [(ngModel)]="filters.minPrice" (ngModelChange)="applyFilters()" placeholder="0">
    </div>
    <div class="filter-group">
        <label>Precio Máx</label>
        <input type="number" [(ngModel)]="filters.maxPrice" (ngModelChange)="applyFilters()" placeholder="Max">
    </div>
    <div class="filter-actions">
        <button class="btn-clear" (click)="clearFilters()">Limpiar</button>
    </div>
  </div>

  <div *ngIf="loading" class="loading-state">
    <div class="spinner"></div>
    <p>Cargando pedidos...</p>
  </div>

  <div *ngIf="!loading && orders.length === 0" class="empty-state">
    <p>Aún no has realizado ningún pedido.</p>
    <a routerLink="/productos" class="btn-shop">Ir a la tienda</a>
  </div>

  <div class="orders-list" *ngIf="!loading && orders.length > 0">
    <div class="order-card" *ngFor="let order of orders" (click)="viewOrder(order)">
      <div class="card-header">
        <span class="order-id">#{{ order.id }}</span>
        <span class="order-date">{{ order.created_at | date:'d MMM y' }}</span>
      </div>
      
      <div class="card-body">
        <div class="info-row">
            <span class="label">Total:</span> 
            <span class="value total">{{ order.total | currency:'EUR' }}</span>
        </div>
        <div class="info-row status-row">
            <span class="status-badge" [ngClass]="getBadgeClass(order.state)">
                {{ order.state }}
            </span>
        </div>
      </div>
      
      <div class="card-footer">
          <span class="view-details">Ver detalles →</span>
      </div>
    </div>
  </div>
</div>

<app-order-details-modal
  [isOpen]="showDetails"
  [order]="selectedOrder"
  (close)="closeDetails()"
  (orderUpdated)="refreshOrders()"
>
</app-order-details-modal>
